## work-plan-2023-10-16

### 播客二期
1. 音频6路ASR资源部署并挂到线上域名 - 已完成
2. log-proc推送播放等级 - 未开始
3. ASR增加换出功能,能够根据videoType区分不同的换出(待定) - 泽宇出方案
4. 播客音频转码最大允许10小时 - 泽宇出方案
5. exchange针对音频的protocol字段需要和视频的统一

### video-ai 迁移kafka事项 - 完成

### 媒体库视频集MySQL优化 - 进行中

1. 8422-8429端口容量过大- 预计下周开始拆分
2. 媒体库 - 上线完成,待切写
3. union - 上线完成,待切写

### 媒体库切主后连接未飘走问题排查
> 9月22号MySQL 9936,9938主库挂了,切主后服务未恢复

1. form地址 [](https://git.intra.weibo.com/im/form/-/issues/8007)
2. pass测试环境部署,使用IP断网尝试复现中 - 进行中


### 媒体库三可用区
1. MC三机房资源 - 已完成  (15442 需上线)
2. redis三可用区 - data mesh支持后,修改peppa后台
3. MC getMulti 从主节点获取 - 待data mesh支持 

### 广告视频审核通过,但视频被删除优化(建强)
1. MC端口15182集群 因data mesh开启了异步写入,间隔较短读出旧值推送Trigger - 胡云鹏(已反馈,待确认解决方案)
2. 审核等较敏感推送trigger之前重新访问DB主库 - 待开发

### 媒体库服务变慢问题排查
> 分布式锁以为某些前端机单点故障,占用锁不释放解决方案

1. 锁是否要修改为乐观锁,乐观锁不会有互相影响,但是请求可能就丢了
2. 缓存更新, 队列机保证最终一致性
3. 缓存乐观锁更新,队里机保证最终一致性

### 媒体库`video_type`使用meta中的数据
> 背景: 修正`biz_type`和`video_type`的时候[具体方案地址](https://git.intra.weibo.com/im/form/-/issues/7914)

1. 上传针对bizType和videoType不一致的情况根据bizType加白, 例如 ("oasis,oasis_video")才可以通过 - 已完成
2. 媒体库`initMedia()`将videoType保存起来,并以该type为准 - 建强
3. exchange直接使用修正后的meta中的videoType - 建强 (先打日志统计不一致的情况,然后确认无误后修改同步对象库domainID)
4. 梳理仍在使用的不一致的业务方,梳理后列一个修改计划和对接人 - 建强
5. 4937110654746644 梳理发布整个流程调用链路

