## G1垃圾收集器从JDK8到JDK18的优化点

> 背景: 视频媒体库是微博每日视频发布量100万左右下的统一存储服务,上行视频发布,转码输出,视频内容理解内容等的统一存储, 下行视频业务,上亿级别视频播放依赖等
> 目前尝试从JDK8+G1升级`JDK17.0.3`和ZGC垃圾回收器的组合,同时也尝试G1垃圾收集组合,意外发现`JDK17+G1`组合在接口平均耗时以及P99等指标表现同`JDK17+ZGC`



CMS垃圾回收器阶段有四个

初始标记- STW
并发标记- 并发
再标记 -STW
并发清楚  


cup资源敏感,因为和工作线程并发执行,也就是所有并行回收垃圾回收器都存在
浮动垃圾,并发清楚阶段回收小于分配内存速率的话会产生浮动垃圾,甚至会导致是其他垃圾回收器进行回收
标记-清除算法会产生内存分片,隔一段时间就需要对内存进行整理,耗时较长


G1收集器的特点,首先从整个分区的概念上有跨越式的改变,将连续内存区域分成多个较小的分区作为垃圾回收的最小单元,同样也是分代垃圾回收器,young gc是对整个young区进行回收,其中mixed gc 是选择回收价值最高的区域+young区进行回收, 可以设置最大期望的停顿时间,g1会根据期望的停顿时间来选择垃圾回收哪些区域,在回收速率和停顿时间上维持一个较好的平衡

需要说明的一点,每个被回收的分区是可以根据需要供young或者old区所使用


G1由于其需要知道各个分区的引用情况,每个分区会多占用内存