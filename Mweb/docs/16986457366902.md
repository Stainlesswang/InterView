## work-plan-2023-10-26

### 视频服务三节保障(王建强)

1. 往年三节保障文档整理 时间:10月31号开始
2. 扩容, 降级, Pass平台测试是否可用 时间:10月31号开始
3. 媒体库 MC, redis,下行做了可用区隔离,验证是否能做到可用区隔离


### 播客二期
1. log-proc推送播放等级 - 未开始
2. ASR增加换出功能,能够根据videoType区分不同的换出(待定) - 泽宇出方案
3. 播客音频转码最大允许10小时 - 泽宇出方案
4. exchange针对音频的protocol字段需要和视频的统一

### video-ai 迁移kafka事项 - 完成

### 媒体库视频集MySQL优化 - 进行中

1. 8422-8429端口容量过大- 预计下周开始拆分
2. 媒体库 - 上线完成,待切写
3. union - 上线完成,待切写

### 媒体库切主后连接未飘走问题排查
> 9月22号MySQL 9936,9938主库挂了,切主后服务未恢复

1. form地址 [](https://git.intra.weibo.com/im/form/-/issues/8007)
2. pass测试环境部署,使用IP断网尝试复现中 - 进行中


### 媒体库三可用区
1. MC三机房资源 - 已完成  (15442 需上线)
2. redis三可用区 - data mesh支持后,修改peppa后台
3. MC getMulti 从主节点获取 - 待data mesh支持 

### 广告视频审核通过,但视频被删除优化(建强)
1. MC端口15182集群 因data mesh开启了异步写入,间隔较短读出旧值推送Trigger - 胡云鹏(已反馈,待确认解决方案)
2. 审核等较敏感推送trigger之前重新访问DB主库 - 待开发

### 媒体库服务变慢问题排查
> 分布式锁以为某些前端机单点故障,占用锁不释放解决方案

1. 锁是否要修改为乐观锁,乐观锁不会有互相影响,但是请求可能就丢了
2. 缓存更新, 队列机保证最终一致性
3. 缓存乐观锁更新,队里机保证最终一致性

### 媒体库`video_type`使用meta中的数据
> 背景: 修正`biz_type`和`video_type`的时候[具体方案地址](https://git.intra.weibo.com/im/form/-/issues/7914)

1. 上传针对bizType和videoType不一致的情况根据bizType加白, 例如 ("oasis,oasis_video")才可以通过 - 已完成
2. 媒体库`initMedia()`将videoType保存起来,并以该type为准 - 建强
3. exchange直接使用修正后的meta中的videoType - 建强 (先打日志统计不一致的情况,然后确认无误后修改同步对象库domainID)
4. 梳理仍在使用的不一致的业务方,梳理后列一个修改计划和对接人 - 建强
5. 4937110654746644 梳理发布整个流程调用链路



痛点:序号小优先级高

1. 查日志优化: 查出来的物理机IP为:10.93.XX.XX,kubectl查出来的屋里IP为:`cn1-b.virtual-kubelet` 没办法知道是哪个pod
2. 查日志优化: 查日志太耗时
3. 一键扩缩容,不用提mr,回滚mr


视频的内容输出有:  音频,截图,发博

每个内容有子任务,可支持的能力有: 
1. 音频: 语音转文字
2. 发博: 内容写入异步队列
3. 截图DNA: 文本区域检测,三明治视频检测,视频标签识别
4. 截图AI: 画质评分(不同模型)